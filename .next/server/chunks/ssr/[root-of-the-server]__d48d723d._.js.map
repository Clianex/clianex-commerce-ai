{"version":3,"sources":["../../../../lib/prisma.ts","../../../../app/%28app%29/autoblogging/page.jsx","../../../../lib/permissions.js"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: [\"error\"],\n  });\n\nif (process.env.NODE_ENV !== \"production\") {\n  globalForPrisma.prisma = prisma;\n}\n","import { auth } from \"@clerk/nextjs/server\";\r\nimport { redirect } from \"next/navigation\";\r\nimport { hasModuleAccess } from \"@/lib/permissions\";\r\n\r\nexport default async function AutobloggingPage() {\r\n  const { userId } = auth();\r\n\r\n  // Si no está logueado (doble seguridad)\r\n  if (!userId) {\r\n    redirect(\"/sign-in\");\r\n  }\r\n\r\n  // Verificación REAL de permiso\r\n  const hasAccess = await hasModuleAccess({\r\n    clerkId: userId,\r\n    moduleKey: \"autoblogging\",\r\n  });\r\n\r\n  // Si no tiene el módulo → fuera\r\n  if (!hasAccess) {\r\n    redirect(\"/marketplace\");\r\n  }\r\n\r\n  // --- Página normal ---\r\n  return (\r\n    <section className=\"mx-auto max-w-6xl px-6 py-10\">\r\n      <h1 className=\"text-3xl font-bold\">Autoblogging</h1>\r\n      <p className=\"mt-2 text-muted-foreground\">\r\n        Gestión automática de contenidos con IA.\r\n      </p>\r\n\r\n      {/* CONTENIDO DEL MÓDULO */}\r\n    </section>\r\n  );\r\n}\r\n","import { prisma } from \"@/lib/prisma\";\r\n\r\n/**\r\n * Comprueba si un usuario tiene acceso a un módulo concreto\r\n *\r\n * @param {Object} params\r\n * @param {string} params.clerkId - userId de Clerk\r\n * @param {string} params.moduleKey - key única del módulo (ej: \"autoblogging\")\r\n * @returns {Promise<boolean>}\r\n */\r\nexport async function hasModuleAccess({ clerkId, moduleKey }) {\r\n  if (!clerkId || !moduleKey) return false;\r\n\r\n  const user = await prisma.user.findUnique({\r\n    where: { clerkId },\r\n    include: {\r\n      modules: {\r\n        where: {\r\n          active: true,\r\n          module: {\r\n            key: moduleKey,\r\n          },\r\n        },\r\n        include: {\r\n          module: true,\r\n        },\r\n      },\r\n    },\r\n  });\r\n\r\n  if (!user) return false;\r\n\r\n  return user.modules.length > 0;\r\n}\r\n"],"names":[],"mappings":"idAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAMO,IAAM,EAJW,AAKtB,WAAgB,MAAM,EACtB,IAAI,EAAA,YAAY,CAAC,CACf,IAAK,CAAC,QAAQ,AAChB,+DCVF,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OCDA,EAAA,EAAA,CAAA,CAAA,OAUO,eAAe,EAAgB,SAAE,CAAO,WAAE,CAAS,CAAE,EAC1D,GAAI,CAAC,GAAW,CAAC,EAAW,MAAO,GAEnC,IAAM,EAAO,MAAM,EAAA,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CACxC,MAAO,SAAE,CAAQ,EACjB,QAAS,CACP,QAAS,CACP,MAAO,CACL,OAAQ,GACR,OAAQ,CACN,IAAK,CACP,CACF,EACA,QAAS,CACP,QAAQ,CACV,CACF,CACF,CACF,SAEA,CAAI,CAAC,GAEE,EAAK,CAFD,MAEQ,CAAC,AAFF,MAEQ,CAAG,CAC/B,CD7Be,eAAe,IAC5B,GAAM,QAAE,CAAM,CAAE,CAAG,CAAA,EAAA,EAAA,IAAA,AAAI,IAmBvB,OAhBI,AAAC,GACH,CAAA,EAAA,EAAA,AADW,QACX,AAAQ,EAAC,YAIO,AAMd,CAAC,KANmB,EAAgB,CACtC,GAKc,KALL,EACT,UAAW,cACb,IAIE,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,gBAKT,CAAA,EAAA,EAAA,IAAA,EAAC,UAAA,CAAQ,UAAU,yCACjB,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,8BAAqB,iBACnC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,sCAA6B,+CAOhD"}